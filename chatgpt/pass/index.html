<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç°¡æ˜“ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒˆ</title>
  <style>
    :root { --gap: 14px; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic UI", sans-serif; margin: 0; background: #0b1020; color: #e9eef8; }
    .wrap { min-height: 100svh; display: grid; place-items: center; padding: 24px; }
    .card { width: min(520px, 92vw); background: #121a34; border: 1px solid #223264; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); overflow: hidden; }
    .header { padding: 22px 22px 6px; border-bottom: 1px solid #20305e; background: linear-gradient(180deg,#17224b,#131a36); }
    .header h1 { margin: 0; font-size: 1.1rem; font-weight: 700; letter-spacing: .02em; }
    .body { padding: 20px 22px 22px; display: grid; gap: var(--gap); }
    label { font-size: .9rem; color: #c8d6ff; }
    input[type="password"] { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #334a90; background: #0f1732; color: #f4f7ff; outline: none; font-size: 16px; }
    input[type="password"]:focus { border-color: #6ca1ff; box-shadow: 0 0 0 4px rgba(108,161,255,.15); }
    .row { display: grid; gap: 10px; }
    .actions { display: flex; gap: 10px; }
    button { appearance: none; border: 1px solid #3659c9; background: #1b2d74; color: #e8f0ff; padding: 11px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    button:hover { filter: brightness(1.05); }
    .ghost { background: transparent; border-color: #334a90; }
    .muted { font-size: .85rem; color: #9bb0e7; }
    .error { color: #ff8c8c; font-size: .9rem; }
    details { border: 1px dashed #334a90; border-radius: 12px; padding: 12px; }
    details > summary { cursor: pointer; outline: none; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Noto Sans Mono CJK JP", monospace; }
    .ok { color: #7dffa3; font-weight: 700; }
    .content { display: none; }
    .content.show { display: block; }
    .protected-card { background: #0f1730; border: 1px solid #2d447e; border-radius: 16px; padding: 16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <div class="header">
        <h1>ğŸ” ç°¡æ˜“ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒˆï¼ˆHTML+JSã®ã¿ï¼‰</h1>
      </div>
      <div class="body">
        <!-- 1) å…¥åŠ›æ¬„ -->
        <div class="row">
          <label for="pw">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input id="pw" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" autocomplete="current-password" />
          <div class="actions">
            <button id="loginBtn">å…¥ã‚‹</button>
            <button class="ghost" id="logoutBtn" title="ä¿å­˜ã—ãŸãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’æ¶ˆã—ã¾ã™">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
          </div>
          <p class="muted">å­¦ç¿’ç”¨ã®â€œãªã‚“ã¡ã‚ƒã£ã¦èªè¨¼â€ã§ã™ã€‚HTML ã ã‘ã§å‹•ãã¾ã™ãŒã€æœ¬ç‰©ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚</p>
          <p id="msg" class="error" role="status" aria-live="polite"></p>
        </div>

        <!-- 3) ä¿è­·ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆæˆåŠŸæ™‚ã«ã ã‘è¡¨ç¤ºï¼‰ -->
        <div id="secret" class="content">
          <div class="protected-card">
            <p class="ok">âœ… èªè¨¼OKï¼</p>
            <ul>
              <li><a href="https://fuyumiki1232.github.io/success/">ãƒªãƒ³ã‚¯</a></li>
            </ul>
          </div>
        </div>

        <hr style="border-color:#223264;" />

  <script>
    // =============================================
    // è¨­å®šï¼šã“ã“ã‚’å¤‰ãˆã‚‹ã ã‘ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
    // åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ "test1234" ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
    // ä¸‹ã®â€œãƒãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ„ãƒ¼ãƒ«â€ã§ä½œã£ãŸæ–‡å­—åˆ—ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
    // =============================================
    const EXPECTED_HASH = "1f1b1508487ae8dd580114c184c78863ee4c87b23e0b79b3c0a951b70c4701c0"; // ãƒ€ãƒŸãƒ¼ã€‚å®Ÿéš›ã¯ä¸‹ã® init ã§å·®ã—æ›¿ãˆ

    // ãƒ‡ãƒ¢ç”¨ï¼šæœ€åˆã®ãƒ­ãƒ¼ãƒ‰æ™‚ã« "test1234" ã®æ­£ã—ã„ãƒãƒƒã‚·ãƒ¥ã‚’æ³¨å…¥ï¼ˆèª¬æ˜ç°¡ç•¥åŒ–ã®ãŸã‚ï¼‰ã€‚
    // å®Ÿé‹ç”¨ã§ã¯ä¸Šã® EXPECTED_HASH ã‚’å›ºå®šæ–‡å­—åˆ—ã«ã—ã¦ãã ã•ã„ã€‚
    let EXPECTED = null;

    // é€£ç¶šå¤±æ•—ã‚«ã‚¦ãƒ³ã‚¿ã¨ãƒ­ãƒƒã‚¯ï¼ˆç°¡æ˜“ï¼‰
    let failCount = 0;
    let lockUntil = 0;

    const els = {
      pw: document.getElementById('pw'),
      loginBtn: document.getElementById('loginBtn'),
      logoutBtn: document.getElementById('logoutBtn'),
      msg: document.getElementById('msg'),
      secret: document.getElementById('secret'),
      plain: document.getElementById('plain'),
      hashBtn: document.getElementById('hashBtn'),
      hashOut: document.getElementById('hashOut'),
    };

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ï¼šãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚„ãƒ‡ãƒ¢ç”¨ãƒãƒƒã‚·ãƒ¥ã‚’ç”¨æ„
    window.addEventListener('DOMContentLoaded', async () => {
      // ãƒ‡ãƒ¢ç”¨ï¼š"test1234" ã® SHA-256 ã‚’è¨ˆç®—ã—ã¦ EXPECTED ã«è¨­å®š
      EXPECTED = await sha256Hex('9563brmo');

      // ä¿å­˜ã•ã‚ŒãŸãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹
      const logged = localStorage.getItem('demo_logged') === '1';
      if (logged) {
        showSecret(true);
      }

      // Enter ã§é€ä¿¡
      els.pw.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') els.loginBtn.click();
      });
    });

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    els.loginBtn.addEventListener('click', async () => {
      const now = Date.now();
      if (now < lockUntil) {
        const sec = Math.ceil((lockUntil - now) / 1000);
        return setMsg(`ä¸€æ™‚ãƒ­ãƒƒã‚¯ä¸­ã§ã™ã€‚${sec} ç§’å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚`);
      }

      const pw = els.pw.value;
      if (!pw) return setMsg('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');

      const hash = await sha256Hex(pw);
      const ok = (hash === (EXPECTED ?? EXPECTED_HASH));

      if (ok) {
        setMsg('');
        failCount = 0;
        localStorage.setItem('demo_logged', '1');
        showSecret(true);
        els.pw.value = '';
      } else {
        failCount++;
        if (failCount >= 5) {
          // 5å›é€£ç¶šãƒŸã‚¹ã§30ç§’ãƒ­ãƒƒã‚¯ï¼ˆå­¦ç¿’ç”¨ï¼‰
          lockUntil = Date.now() + 30 * 1000;
          failCount = 0;
          setMsg('å¤±æ•—ãŒå¤šã™ãã¾ã™ã€‚30ç§’é–“ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸã€‚');
        } else {
          setMsg('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚');
        }
      }
    });

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    els.logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('demo_logged');
      showSecret(false);
      setMsg('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
      els.pw.focus();
    });

    // ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ„ãƒ¼ãƒ«
    els.hashBtn.addEventListener('click', async () => {
      const text = els.plain.value ?? '';
      if (!text) {
        els.hashOut.textContent = 'ï¼ˆå…¥åŠ›ãŒç©ºã§ã™ï¼‰';
        return;
      }
      const h = await sha256Hex(text);
      els.hashOut.textContent = h;
    });

    function showSecret(show) {
      els.secret.classList.toggle('show', !!show);
    }

    function setMsg(text) {
      els.msg.textContent = text;
    }

    // ---- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼šSHA-256 ã‚’16é€²æ–‡å­—åˆ—ã§è¿”ã™ ----
    async function sha256Hex(text) {
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      const bytes = new Uint8Array(buf);
      return [...bytes].map(b => b.toString(16).padStart(2, '0')).join('');
    }
  </script>
</body>
</html>
